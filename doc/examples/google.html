<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
    <title>loa Reference</title>
    <link rel="stylesheet" href="../ldoc.css" type="text/css" />
</head>
<body>

<div id="container">

<div id="product">
	<div id="product_logo"></div>
	<div id="product_name"><big><b></b></big></div>
	<div id="product_description"></div>
</div> <!-- id="product" -->


<div id="main">


<!-- Menu -->

<div id="navigation">
<br/>
<h1>loa</h1>




<h2>Examples</h2>
<ul class="$(kind=='Topics' and '' or 'nowrap'">
  <li><strong>google</strong></li>
  <li><a href="../examples/token_transport.html">token_transport</a></li>
</ul>
<h2>Modules</h2>
<ul class="$(kind=='Topics' and '' or 'nowrap'">
  <li><a href="../index.html">loa</a></li>
</ul>

</div>

<div id="content">

    <pre>
<span class="comment">--- This script will authenticate a user with google drive and print out
</span><span class="comment">-- all available information about the files that they have stored.
</span><span class="comment">-- Add your cliend ID and client secret below.
</span>
<span class="keyword">local</span> loa=<span class="global">require</span> <span class="string">"loa"</span>
<span class="keyword">local</span> authorization_endpoint = <span class="string">"https://accounts.google.com/o/oauth2/auth"</span>
<span class="keyword">local</span> token_endpoint         = <span class="string">"https://accounts.google.com/o/oauth2/token"</span>
<span class="keyword">local</span> resource_endpoint      = <span class="string">"https://www.googleapis.com/drive/v2"</span>
<span class="keyword">local</span> client_id              = <span class="string">"Your Client ID"</span>
<span class="keyword">local</span> client_secret          = <span class="string">"Your Client Secret"</span>

<span class="keyword">local</span> client=loa.new(authorization_endpoint, token_endpoint, resource_endpoint,
    client_id, client_secret)

<span class="keyword">local</span> redirect_uri =<span class="string">"http://localhost:8081/"</span>
<span class="keyword">local</span> scope        =<span class="string">"https://www.googleapis.com/auth/drive.readonly.metadata"</span>
<span class="keyword">local</span> state        =<span class="keyword">nil</span> <span class="comment">-- Can be a string that will be returned by google
</span><span class="keyword">local</span> default_query_parameters={key=<span class="string">"value"</span>}

<span class="keyword">local</span> auth_uri=client:auth_uri(redirect_uri, scope, state,
    default_query_parameters)

<span class="comment">--- Direct the user to the generated authorization URI
</span><span class="comment">-- On Windows
</span><span class="global">os</span>.execute(<span class="global">string</span>.format(<span class="string">'start %s'</span>, auth_uri:gsub(<span class="string">"&amp;"</span>,<span class="string">'^&amp;'</span>)))
<span class="comment">-- Unix-likes
</span><span class="comment">-- os.execute(string.format("open '%s'", auth_uri))
</span>
<span class="comment">-- Since we're not actually running a server we can use loa's _catch_redirect
</span><span class="comment">-- function to get the http request being generated google.
</span><span class="keyword">local</span> data=client._catch_redirect(redirect_uri)

<span class="comment">-- Retrieve the code from the HTTP message we captured.
</span>code=data:match(<span class="string">'code=([^%s&amp;]+)'</span>)

<span class="comment">-- Request the token from google
</span>client:request_token(<span class="keyword">nil</span>, redirect_uri, {code=code})

<span class="keyword">for</span> k,v <span class="keyword">in</span> <span class="global">pairs</span>(client) <span class="keyword">do</span> <span class="global">print</span> (k,v) <span class="keyword">end</span>

<span class="comment">-- Now you can make requests against your user account on google drive
</span><span class="keyword">local</span> tbl=client:request(<span class="string">"/files"</span>)

<span class="keyword">for</span> k,v <span class="keyword">in</span> <span class="global">pairs</span>(tbl) <span class="keyword">do</span> <span class="global">print</span>(k,v) <span class="keyword">end</span></pre>


</div> <!-- id="content" -->
</div> <!-- id="main" -->
<div id="about">
<i>generated by <a href="http://github.com/stevedonovan/LDoc">LDoc 1.4.2</a></i>
</div> <!-- id="about" -->
</div> <!-- id="container" -->
</body>
</html>
